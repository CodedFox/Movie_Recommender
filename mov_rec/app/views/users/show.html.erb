<p id="notice"><%= notice %></p>

<% @profile = Profile.find_by user_id: @user.id %>

<h2>Profile</h2>

<p>
  <strong>Email:</strong>
  <%= @user.email %>
</p>

<% if @profile == nil %>

  <% controller.redirect_to "/profiles/new?userid=#{@user.id}" %>

<% else %>

  <p>
    <strong>First Name:</strong>
    <%= @profile.first_name %>
  </p>

  <p>
    <strong>Last Name:</strong>
    <%= @profile.last_name %>
  </p>

  <p>
    <strong>Date of Birth:</strong>
    <%= @profile.date_of_birth %>
  </p>

  <p>
    <strong>Gender:</strong>
    <%= @profile.gender %>
  </p>

  <p>
    <strong>City:</strong>
    <%= @profile.city %>
  </p>

  <p>
    <strong>Province:</strong>
    <%= @profile.province %>
  </p>

  <p>
    <strong>Country:</strong>
    <%= @profile.country %>
  </p>

  <p>
    <strong>Occupation:</strong>
    <%= @profile.occupation %>
  </p>

  <p>
    <strong>Picture:</strong>
    <%= @profile.picture %>
  </p>

<% end %>

<% @watched = MovieRating.where user_id: @user.id %>

<% @avgrating =  MovieRating.select("avg(user_rating) as avg, count(user_rating) as count, movie_id").group("movie_id") %>

<br>
<br>


<h2>Watched</h2>

<table>
  <thead>
    <tr>
      <th>Movie</th>
      <th>Average<br>Rating</th>
      <th>Times Seen</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody style="border: 1px solid black">
    <% @avgrating.each do |watch| %>
      <% @movie = Movie.find_by id: watch.movie_id %>
      <tr>
        <td style="text-align: center"><%= @movie.name %></td>
        <td style="text-align: center"><%= watch.avg %></td>
        <td style="text-align: center"><%= watch.count %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<br>

<%= link_to 'Edit', edit_user_path(@user) %> |
<%= link_to 'Back', users_path %>

