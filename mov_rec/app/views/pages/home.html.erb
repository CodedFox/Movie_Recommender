<h1>Welcome to Movie Rec!!</h1>
<p>
  
</p>

<h2>Feature Actor!</h2>

<% @factor = MovieCast.
					select("actor_id, count(actor_id) as count").
					group("actor_id").
					order('count DESC').
					take %>

<% @featuredactor = Actor.where(id: @factor.actor_id).take %>

<% @directors = Director.
                  joins(:movie_casts).
                  where(movie_casts: { actor_id: @featuredactor.id }).
                  distinct %>

<% @studios = Studio.
                  joins(:movie_casts).
                  where(movie_casts: { actor_id: @featuredactor.id }).
                  distinct %>

<div>
<% unless @featuredactor.picture.blank? %>
  <img src="<%= @featuredactor.picture %>" style="width: 200px; float: left; padding: 5px">
<% end %>

<div style="padding: 5px">

<p>
  <h3><a href="/actors/<%= @featuredactor.id %>"><%= @featuredactor.first_name %> <%= @featuredactor.last_name %></a></h3>
</p>

<p>
  <strong>Date of birth:</strong>
  <%= @featuredactor.date_of_birth %>
</p>

<p>
  <strong>Place of birth:</strong>
  <%= @featuredactor.place_of_birth %>
</p>

<p>
  <strong>Gender:</strong>
  <%= @featuredactor.gender %>
</p>

<br>
<br>
<br>
<br>
<br>

<h4>Directors our actor has worked with!</h4>

<table>
  <thead>
    <tr>
      <th>Picture</th>
      <th>Name</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @directors.each do |director| %>
      <tr>
        <% if director.picture.blank? %>
          <td><img src="<%= director.picture %>" style="width: 75px; visibility: hidden"></td>
        <% else %>
          <td><img src="<%= director.picture %>" style="width: 75px"></td>
        <% end %>
        <td><%= director.first_name %> <%= director.last_name %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<h4>Studios our actor has worked with!</h4>

<table>
  <thead>
    <tr>
      <th>Picture</th>
      <th>Name</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @studios.each do |studio| %>
      <tr>
        <% if studio.picture.blank? %>
          <td><img src="<%= studio.picture %>" style="width: 75px; visibility: hidden"></td>
        <% else %>
          <td><img src="<%= studio.picture %>" style="width: 75px"></td>
        <% end %>
        <td><%= studio.studio_name %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<br>
<br>
<br>
<br>

<% @couple = MovieCast.
                select("movie_casts.actor_id as a1, m2.actor_id as a2, count(m2.movie_id) as m").
                joins("JOIN movie_casts AS m2
                            ON movie_casts.movie_id = m2.movie_id").
                where("movie_casts.actor_id > m2.actor_id").
                group(['a1', 'a2']).
                order('m DESC').
                take %>

<h2>Couples - Together in <%= @couple.m %> movies!</h2>

<% @couple1 = Actor.where(id: @couple.a1).take %>
<% @couple2 = Actor.where(id: @couple.a2).take %>

<% unless @couple1.picture.blank? %>
  <img src="<%= @couple1.picture %>" style="width: 200px; float: left; padding: 5px">
<% end %>

<div style="padding: 5px">

<p>
  <h3><a href="/actors/<%= @couple1.id %>"><%= @couple1.first_name %> <%= @couple1.last_name %></a></h3>
</p>

<p>
  <strong>Date of birth:</strong>
  <%= @couple1.date_of_birth %>
</p>

<p>
  <strong>Place of birth:</strong>
  <%= @couple1.place_of_birth %>
</p>

<p>
  <strong>Gender:</strong>
  <%= @couple1.gender %>
</p>

<br>
<br>
<br>
<br>
<br>

<% unless @couple2.picture.blank? %>
  <img src="<%= @couple2.picture %>" style="width: 200px; float: left; padding: 5px">
<% end %>

<div style="padding: 5px">

<p>
  <h3><a href="/actors/<%= @couple2.id %>"><%= @couple2.first_name %> <%= @couple2.last_name %></a></h3>
</p>

<p>
  <strong>Date of birth:</strong>
  <%= @couple2.date_of_birth %>
</p>

<p>
  <strong>Place of birth:</strong>
  <%= @couple2.place_of_birth %>
</p>

<p>
  <strong>Gender:</strong>
  <%= @couple2.gender %>
</p>